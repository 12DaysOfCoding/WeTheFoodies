<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: assets/scripts/database.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: assets/scripts/database.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { db } from './auth.js';
import { auth } from './auth.js';
import {
  ref,
  get,
  child,
  push,
  remove
} from 'https://www.gstatic.com/firebasejs/9.8.0/firebase-database.js';

/**
 * Adds recipes that the user has made. Only contains relevant information.
 * @param {*} recipeName Name of the recipe being saved
 * @param {*} servings Serving size of the recipe
 * @param {*} cookTime Cook time of the recipe
 * @param {*} instructions List of strings that make up the instrcutions
 * @param {*} dietRestrictions List of booleans for the user recipes
 * @param {*} ingredients List of ingredients for the user recipes
 * 
 */
export async function add_user_recipe(recipeHash, recipeName, servings, cookTime, instructions, dietRestrictions, ingredients, difficultyRealLevel) {
 
 
  const userRecipes = ref(db, 'users/' + auth.currentUser.uid + '/UserRecipes');
  await push(userRecipes, {
    Name: recipeName,
    Servings: servings,
    CookTime: cookTime,
    Instructions: instructions,
    DietRestrictions: dietRestrictions,
    Ingredients: ingredients,
    Hash: recipeHash,
    Difficulty: difficultyRealLevel
  });
  return true;
}

/**
 * Get list of the user's created recipes
 * @returns A list of user's past created recipes
 */
export async function get_user_recipes() {
  const dbRef = ref(db);
  let finalData = null;
  await get(child(dbRef, `users/${auth.currentUser.uid}/UserRecipes`))
    .then((snapshot) => {
      if (snapshot.exists()) {
        finalData = snapshot.val();
        var userList = [];
        for(var x in finalData)
          userList.push(finalData[x]);
       
        return userList;
      } else 
        console.log('No data available');
            
    })
    .catch(() => {
      // console.error(error);
    });
  return finalData;
}
/**
 * Getting the name of the user's favorited recipe
 * @param {*} recipeName Name (not hashkey) of the favorite recipe being added to the DB
 */
export function add_favorite(recipeName){

  const favRecipes = ref(db, 'users/' + auth.currentUser.uid + '/FavoriteRecipes');
  push(favRecipes , recipeName);
}

/**
 * Fetch the user's favorite recipes
 * @returns A list object of favorite recipes
 */
export async function get_favorites(){
  const dbRef = ref(db);
  let finalData = null;
  await get(child(dbRef, `users/${auth.currentUser.uid}/FavoriteRecipes`))
    .then((snapshot) => {
      if (snapshot.exists()) {
        finalData = snapshot.val();
        return finalData;
      } else 
        console.log('No data available');
            
    })
    .catch(() => {
      // console.error(error);
    });
  return finalData;
}

/**
 * Deletes the recipe matching the hash in the database under the user created recipes
 * @param {*} recipeHash 
 */
export async function delete_user_recipe(recipeHash){
  const dbRef = ref(db);
  await get(child(dbRef, `users/${auth.currentUser.uid}/UserRecipes`)).then((snapshot) => {
    snapshot.forEach(function(childSnapshot) {
      if(childSnapshot.val().Hash === recipeHash){
        const childRef =  ref(db, 'users/' + auth.currentUser.uid + '/UserRecipes/' + childSnapshot.key);
        remove(childRef);
      }
      
    });
  });

}


/**
 * Edits the recipe matching the name in the database under the user created recipe
 * @param {*} recipeName Name of the recipe to edit
 * @param {*} recipe Recipe object to extract data
 */
export async function edit_recipe(recipe_hash, recipe){
  await delete_user_recipe(recipe_hash);
  await add_user_recipe(recipe_hash, recipe.name,recipe.servings, recipe.readyInMinutes, recipe.steps, recipe.intolerances, recipe.ingredients,recipe.difficulty_realLevel  );



}

/**
 * Deletes the recipe matching the name in the database under their favorites
 * @param {*} recipeName 
 */
export async function delete_favorite_recipe(recipeName){
  recipeName = recipeName.split('$')[0];
  const dbRef = ref(db);
  await get(child(dbRef, `users/${auth.currentUser.uid}/FavoriteRecipes`)).then((snapshot) => {
    snapshot.forEach(function(childSnapshot) {
      if(childSnapshot.val() === recipeName){
        const childRef =  ref(db, 'users/' + auth.currentUser.uid + '/FavoriteRecipes/' + childSnapshot.key);
        remove(childRef);
      }
      
    });
  });

}


</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-backend.html">backend</a></li><li><a href="module-index.html">index</a></li><li><a href="module-recipe-add.html">recipe-add</a></li><li><a href="module-recipe-data.html">recipe-data</a></li><li><a href="module-recipe-detail.html">recipe-detail</a></li><li><a href="module-recipe-edit.html">recipe-edit</a></li></ul><h3>Global</h3><ul><li><a href="global.html#add">add</a></li><li><a href="global.html#add_favorite">add_favorite</a></li><li><a href="global.html#add_user_recipe">add_user_recipe</a></li><li><a href="global.html#bindCheckboxes">bindCheckboxes</a></li><li><a href="global.html#bindSearchBar">bindSearchBar</a></li><li><a href="global.html#bindSearchButton">bindSearchButton</a></li><li><a href="global.html#clearDropdowns">clearDropdowns</a></li><li><a href="global.html#configureRecipeCards">configureRecipeCards</a></li><li><a href="global.html#defaultPreference">defaultPreference</a></li><li><a href="global.html#delete_favorite_recipe">delete_favorite_recipe</a></li><li><a href="global.html#delete_user_recipe">delete_user_recipe</a></li><li><a href="global.html#displayCards">displayCards</a></li><li><a href="global.html#edit_recipe">edit_recipe</a></li><li><a href="global.html#get_favorites">get_favorites</a></li><li><a href="global.html#get_user_recipes">get_user_recipes</a></li><li><a href="global.html#hitSearch">hitSearch</a></li><li><a href="global.html#readPreference">readPreference</a></li><li><a href="global.html#registerCheckboxes">registerCheckboxes</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Fri Jun 10 2022 23:55:33 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
